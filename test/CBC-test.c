#include <stdio.h>
#include "CBC.h"
#include "pkcs7.h"
#include "aes.h"
#include <stdlib.h>

int main()
{
    // 평문은 문자열임을 가정
    // Test Vector
    unsigned char plainText1[33] = {0x6b, 0xc1, 0xbe, 0xe2, 0x2e, 0x40, 0x9f, 0x96, 0xe9, 0x3d, 0x7e, 0x11, 0x73, 0x93, 0x17, 0x2a,
                                    0x6b, 0xc1, 0xbe, 0xe2, 0x2e, 0x40, 0x9f, 0x96, 0xe9, 0x3d, 0x7e, 0x11, 0x73, 0x93, 0x17, 0x2a, '\0'};
    unsigned char key1[16] = {0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c};
    unsigned char IV1_enc[16] = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f};
    unsigned char IV1_dec[16] = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f};
    // Expected CipherText: 0x76, 0x49, 0xab, 0xac, 0x81, 0x19, 0xb2, 0x46, 0xce, 0xe9, 0x8e, 0x9b, 0x12, 0xe9, 0x19, 0x7d
    
    size_t len = 0;
    // padding
    unsigned char *pad_plainText = pkcs7_padding(plainText1, 16, &len);
    unsigned char output[32] = {0,};
    
    //AES128 CBC 암호화
    CBC_enc(AES128_Encrypt, IV1_enc, key1, 16, len, pad_plainText, output);

    for (int i = 0; i < 32; i++)
        printf("%02x ", output[i]);
    printf("\n");

    // ECB 복호화
    unsigned char output2[32] = {0,};
    CBC_dec(AES128_Decrypt, IV1_dec, key1, 16, len, output, output2);
    
    for (int i = 0; i < 32; i++)
        printf("%02x ", output2[i]);
    printf("\n");
    
    free(pad_plainText);
}